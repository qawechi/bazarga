+function(a){"use strict";function b(b){this.$pins=b,this.tasks=[],this.timerId=null,this.deferred=new a.Deferred}function c(a){this.img=a,this.initialWidth=a.width,this.initialHeight=a.height}function d(b){return this.each(function(){var c=a(this),d=c.data("mystist.waterfall"),e="object"==typeof b&&b;d&&"string"!=typeof b&&d.destroy()&&(d=null),d||c.data("mystist.waterfall",d=new f(this,e)),"string"==typeof b&&d[b]()})}var e=e||{now:Date.now||function(){return(new Date).getTime()},throttle:function(a,b,c){var d,f,g,h=null,i=0;c||(c={});var j=function(){i=c.leading===!1?0:e.now(),h=null,g=a.apply(d,f),h||(d=f=null)};return function(){var k=e.now();i||c.leading!==!1||(i=k);var l=b-(k-i);return d=this,f=arguments,0>=l||l>b?(h&&(clearTimeout(h),h=null),i=k,g=a.apply(d,f),h||(d=f=null)):h||c.trailing===!1||(h=setTimeout(j,l)),g}},debounce:function(a,b,c){var d,f,g,h,i,j=function(){var k=e.now()-h;b>k&&k>=0?d=setTimeout(j,b-k):(d=null,c||(i=a.apply(g,f),d||(g=f=null)))};return function(){g=this,f=arguments,h=e.now();var k=c&&!d;return d||(d=setTimeout(j,b)),k&&(i=a.apply(g,f),g=f=null),i}}},f=function(b,c){this.$element=a(b),this.options=a.extend({},f.DEFAULTS,c),this.id=Math.random().toString().slice(2),this.$fakePin=null,this.$container=null,this.$pins=null,this.pinWidth=null,this.imgWidth=null,this.rights=[],this.tops=[],this.init().calculateWidth().calculatePosition().sail(),a(window).on("resize.mystist.waterfall"+this.id,e.debounce(a.proxy(function(){a(window).off("scroll.mystist.waterfall"+this.id),this.calculateWidth().calculatePosition().ship(g.getLoadedPins.call(this))},this),777))};f.VERSION="0.2.4",f.DEFAULTS={},f.prototype.init=function(){return this.initPins().initAttributes(),this},f.prototype.initPins=function(){var b=this.$element.children().length>0?this.$element.children().remove():a(this.$element.data("bootstrap-waterfall-template"));return b.each(function(){var b=a(this).find("img:eq(0)");b.length>0&&(a(this).data("bootstrap-waterfall-src",b.attr("src")),b.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="))}),this.$pins=b,this},f.prototype.initAttributes=function(){return this.$fakePin=this.$pins.first().clone(),this.$container=a("<div />").css("position","relative"),this.$element.html(this.$container),this},f.prototype.calculateWidth=function(){var a=this.$fakePin.clone();return this.$container.append(a.css("opacity",0)),this.pinWidth=a.outerWidth(!0),this.imgWidth=a.find("img:eq(0)").css("width","100%").width(),a.remove(),this},f.prototype.calculatePosition=function(){for(var a=parseInt(this.$container.width()/this.pinWidth,10),b=[],c=[],d=0;a>d;d++)b.push(d*this.pinWidth),c.push(0);return this.rights=b,this.tops=c,this},f.prototype.sail=function(){var c=g.getToLoadPins.call(this),d=new b(c);return d.load().run().deferred.done(a.proxy(function(){this.ship(c)},this)),this},f.prototype.ship=function(b){return this.render(b).updateHeight(),a(window).on("scroll.mystist.waterfall"+this.id,e.throttle(a.proxy(function(){g.isWantMore.call(this)&&(a(window).off("scroll.mystist.waterfall"+this.id),this.sail())},this),500)),this},f.prototype.render=function(b){var c=this;return b.each(function(){c.placePin(a(this))}),this},f.prototype.placePin=function(a){var b=h.indexOf(this.tops,Math.min.apply(null,this.tops)),c=g.getPosition.call(this,b);return a.css({position:"absolute",right:c.right,top:c.top}),a.data("bootstrap-waterfall-pin")&&g.setImageHeight.call(this,a),a.data("bootstrap-waterfall-src")&&(g.makeImageAvailable.call(this,a),a.removeData("bootstrap-waterfall-src")),this.$container.append(a),g.updatePosition.call(this,b,a),this},f.prototype.updateHeight=function(){var a=h.indexOf(this.tops,Math.max.apply(null,this.tops));return this.$container.height(this.tops[a]),this},f.prototype.destroy=function(){return a(window).off("scroll.mystist.waterfall"+this.id),a(window).off("resize.mystist.waterfall"+this.id),this.$element.empty().removeData("mystist.waterfall"),this};var g={getToLoadPins:function(){var b=parseInt(this.$container.width()/this.pinWidth,10),c=3*b,d=this.$pins.map(function(){return a(this).find("img").length>0&&a(this).data("bootstrap-waterfall-src")?a(this):void 0});return d.slice(0,c)},getLoadedPins:function(){var b=this.$pins.map(function(){return a(this).find("img").length>0&&!a(this).data("bootstrap-waterfall-src")?a(this):void 0});return b},isWantMore:function(){return a(window).scrollTop()+a(window).height()>h.getDocHeight()-377},getPosition:function(a){var b={right:this.rights[a],top:this.tops[a]};return b},setImageHeight:function(a){var b=a.data("bootstrap-waterfall-pin"),c=this.imgWidth*b.img.height/b.img.width;a.find("img:eq(0)").css({height:c,width:"auto"})},makeImageAvailable:function(a){a.find("img:eq(0)").attr("src",a.data("bootstrap-waterfall-src"))},updatePosition:function(a,b){this.tops[a]+=b.outerHeight(!0)}};b.prototype.load=function(){var b=this;return this.$pins.each(function(){var d=new Image;d.src=a(this).data("bootstrap-waterfall-src");var e=new c(d);b.tasks.push(e),a(this).data("bootstrap-waterfall-pin",e)}),this},b.prototype.run=function(){return this.timerId=setInterval(a.proxy(function(){this.isDone()?this.stop():this.check()},this),40),this},b.prototype.isDone=function(){return 0===this.tasks.length},b.prototype.stop=function(){clearInterval(this.timerId),this.timerId=null,this.deferred.resolve()},b.prototype.check=function(){for(var a=0;a<this.tasks.length;a++){var b=this.tasks[a];b.isLoaded()&&this.tasks.splice(a--,1)}},c.prototype.isLoaded=function(){return this.img.width!==this.initialWidth||this.img.height!==this.initialHeight||this.img.width*this.img.height>1024};var h={getDocHeight:function(){var a=document;return Math.max(a.body.scrollHeight,a.documentElement.scrollHeight,a.body.offsetHeight,a.documentElement.offsetHeight,a.body.clientHeight,a.documentElement.clientHeight)},indexOf:function(a,b){if(null==a)return-1;for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}},i=a.fn.waterfall;a.fn.waterfall=d,a.fn.waterfall.Constructor=f,a.fn.waterfall.noConflict=function(){return a.fn.waterfall=i,this}}(jQuery);
